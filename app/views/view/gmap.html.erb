<script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>
<script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>


<h1>This is Gmap page</h1>

<div style='width: 800px;'>
  <div id="map" style='width: 800px; height: 400px;'></div>
</div>

<script type = 'text/javascript'>

  intPointsData = <%=raw @hash_intPointsData.to_json %>;
  eventsData = <%=raw @hash_eventsData.to_json %>;

  console.log(intPointsData);
  console.log(eventsData);

  var map;
  var polylinePath;

  function initMap() {
    // Create a map object and specify the DOM element for display.
    map = new google.maps.Map(document.getElementById('map'), {
      center: {lat: -34.397, lng: 150.644},
      scrollwheel: false,
      zoom: 8
    });
  }

  function drawTripIntermediatePoints(intPointsData) {
    for(var i=0;i<intPointsData.length;i++){

      var marker = new google.maps.Marker({
        //animation: google.maps.Animation.DROP,
        position: intPointsData[i],
        title: 'Hello World!'
      });

      marker.addListener('click',function(e){
          alert(e.latLng);
      })

      marker.setMap(map);

    }
  }

  function drawTripPolyline(intPointsData) {

    var polylineCoordinates = [];
    for(var i=0;i<intPointsData.length;i++){
      polylineCoordinates.push(intPointsData[i]);
    }

    polylinePath = new google.maps.Polyline({
      path: polylineCoordinates,
      geodesic: true,
      strokeColor: '#000000',
      strokeOpacity: 1.0,
      strokeWeight: 2
    });

    polylinePath.setMap(map);
  }

  function showEvents(eventData) {
    
    pointsData = eventData["transferzones"];
    console.log(pointsData.length);

    for(var i=0;i<pointsData.length;i++){
      var marker = new google.maps.Marker({
        position: pointsData[i],
        title: 'Hello World!'
      });
      marker.addListener('click',function(e){
          alert(e.latLng);
      })
      marker.setMap(map);
    }
    
  }

  initMap();
  drawTripIntermediatePoints(intPointsData);
  drawTripPolyline(intPointsData);
  for(var i=0;i<eventsData.length;i++){
    showEvents(eventsData[i]);
  }


</script>